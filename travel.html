<!DOCTYPE html><html lang="zh-Hant"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>韓語年糕｜旅行會話</title><link rel="manifest" href="manifest.json"><link rel="stylesheet" href="styles.css">
<link rel="apple-touch-icon" href="icons/icon-512.png"><script>if('serviceWorker' in navigator){addEventListener('load',()=>navigator.serviceWorker.register('./sw.js'));}</script></head><body>
<header class="topbar"><div class="bar"><h1 class="title"><img src="icons/p2.svg" alt=""></h1></div></header>
<div class="appbar"><div class="row" style="justify-content:space-between;gap:12px;max-width:540px;margin:0 auto;padding:12px 16px 6px 16px">
  <div style="display:flex;gap:12px">
    <span id="voiceEn" class="pill">Moira</span>
  </div>
  <div style="display:flex;gap:8px">
    <span id="mickey" class="pill"><img src="icons/micky.svg" width="20" height="20" alt=""></span>
    <span class="pill amber speed">x0.75</span>
  </div>
</div>
<div class="row" style="justify-content:flex-start;max-width:540px;margin:0 auto;padding:0 16px 8px 16px">
  <div style="font-size:12px;color:#97a1a6">英語：點選名字可切換人物 · 영어: 이름 선택 시 음성 전환<br>按下<img src="icons/micky.svg" style="width:12px;height:12px;vertical-align:middle;margin:0 2px;filter:invert(60%) sepia(5%) saturate(300%) hue-rotate(180deg) brightness(95%) contrast(85%);">切換成米奇模式 · <img src="icons/micky.svg" style="width:12px;height:12px;vertical-align:middle;margin:0 2px;filter:invert(60%) sepia(5%) saturate(300%) hue-rotate(180deg) brightness(95%) contrast(85%);">을 누르면 미키 모드로 바뀝니다</div>
</div>
<div class="tabs"><button class="tab active" data-tab="R">餐廳</button><button class="tab" data-tab="S">購物</button><button class="tab" data-tab="N">問路</button><button class="tab" data-tab="O">其他</button></div></div>
<main class="wrap"><div id="cards" class="list"></div></main>
<nav class="tabbar"><div class="in"><a class='' href='index.html'><span class='ico'><img src='icons/p1.svg' alt=''></span>發音練習</a><a class='active' href='travel.html'><span class='ico'><img src='icons/p2.svg' alt=''></span>旅行會話</a><a class='' href='translate.html'><span class='ico'><img src='icons/p3.svg' alt=''></span>實時翻譯</a><a class='' href='history.html'><span class='ico'><img src='icons/p4.svg' alt=''></span>歷史紀錄</a></div></nav>

<!-- 確認刪除彈窗 -->
<section class="modal" id="confirmDelete" style="display:none"><div class="sheet">
  <button class="close" id="confirmClose" aria-label="關閉">✕</button>
  <h3 class="title" style="text-align:center;margin:6px 0 12px 0;color:#78bfc0">確定要從收藏移除嗎？</h3>
  <div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap">
    <button class="pill" id="confirmYes">確 定</button>
    <button class="pill" id="confirmNo">取 消</button>
  </div>
</div></section>
<script>
const EN=["Daniel","Moira","Samantha","Tessa"];
let RATE=parseFloat(localStorage.getItem('playbackRate')||'0.75'); const SPEEDS=[0.5,0.75,1.0];
let VOICE_EN_NAME = localStorage.getItem('voiceEnName') || 'Moira';
function updateVoiceUI(){ const el=document.getElementById('voiceEn'); if(el) el.textContent = VOICE_EN_NAME; }
function availableEnVoices(){ const all=speechSynthesis.getVoices(); return EN.map(n=>all.find(v=>v.name===n)).filter(Boolean); }
function ensureVoice(){ const avail=availableEnVoices().map(v=>v.name); if(!avail.includes(VOICE_EN_NAME) && avail.length){ VOICE_EN_NAME = avail[0]; localStorage.setItem('voiceEnName', VOICE_EN_NAME); }
  updateVoiceUI(); }
function cycleVoice(){ const avail=availableEnVoices().map(v=>v.name); if(!avail.length) return; const idx=avail.indexOf(VOICE_EN_NAME); VOICE_EN_NAME = avail[(idx+1)%avail.length]; localStorage.setItem('voiceEnName', VOICE_EN_NAME); updateVoiceUI(); }
function updateSpeedUI(){ document.querySelectorAll('.speed').forEach(el=>{ el.textContent='x'+RATE.toFixed(2).replace(/\.00$/,''); }); }
function cycleSpeed(){ const i=SPEEDS.indexOf(RATE); RATE=SPEEDS[(i+1)%SPEEDS.length]; localStorage.setItem('playbackRate', RATE.toString()); updateSpeedUI(); }
function loadEn(){ const all=speechSynthesis.getVoices(); const sel=document.getElementById('voiceEn'); const picked=EN.map(n=>all.find(v=>v.name===n)).filter(Boolean); if(picked.length){ sel.innerHTML=picked.map(v=>`<option>${v.name}</option>`).join(""); const saved=localStorage.getItem('voiceEnName'); if(saved&&picked.some(v=>v.name===saved)) sel.value=saved; sel.addEventListener('change',()=>localStorage.setItem('voiceEnName', sel.value)); } }
window.speechSynthesis.onvoiceschanged = ()=>{ ensureVoice(); };
function loadMickeyState(){ const mickeyState = localStorage.getItem('mickeyMode') === 'true'; const mickey = document.getElementById('mickey'); if(mickeyState && mickey) mickey.classList.add('on'); }
function saveMickeyState(isOn){ localStorage.setItem('mickeyMode', isOn.toString()); }
document.getElementById('mickey').addEventListener('click',e=>{e.currentTarget.classList.toggle('on'); saveMickeyState(e.currentTarget.classList.contains('on'));});

const DATA={R:[
  ["추천 메뉴가 뭐예요?","What do you recommend?","有什麼推薦的嗎？"],
  ["덜 매운 걸로 해 주세요.","Please make it less spicy.","可以做不那麼辣嗎？"],
  ["계산서 따로 해 주세요.","Could we split the bill?","請分開結帳。"],
  ["카드를 스와이프 할 수 있나요?","Can I swipe my card?","可以刷卡嗎？"]
],S:[
  ["이거 다른 색 있어요?","Do you have this in other colors?","這個有別的顏色嗎？"],
  ["이거 S, M, L 사이즈 있어요?","Do you have this in S, M, or L?","這個有沒有 S、M、L 的尺寸？"],
  ["입어 봐도 돼요?","May I try it on?","可以試穿嗎？"],
  ["이거 얼마예요? 할인돼요?","How much is this? Any discount?","這個多少錢？有折扣嗎？"]
],N:[
  ["이 사진처럼 보이는 곳은 어디예요?","Where is this place in the photo?","這張照片裡的地方在哪裡？"],
  ["여기로 가려면 어떻게 가요?","How do I get here?","要到這裡怎麼走？"],
  ["오른쪽/왼쪽/쭉 가세요.","Go right/left/straight.","往右/往左/直走。"]
],O:[
  ["괜찮아요.","Its okay","沒關係。"],["감사합니다.","Thank you.","謝謝。"]
]};

function speakKO(t){ const u=new SpeechSynthesisUtterance(t);u.lang='ko-KR';u.rate=RATE; const v=speechSynthesis.getVoices().find(v=>/ko/i.test(v.lang||'')); if(v) u.voice=v; if(document.getElementById('mickey').classList.contains('on')) u.pitch=1.6; speechSynthesis.speak(u);} 
function speakEN(t){ const v=speechSynthesis.getVoices().find(v=>v.name===VOICE_EN_NAME)||speechSynthesis.getVoices().find(v=>/en/i.test(v.lang||'')); const u=new SpeechSynthesisUtterance(t); if(v) u.voice=v; u.rate=RATE; if(document.getElementById('mickey').classList.contains('on')) u.pitch=1.6; speechSynthesis.speak(u);} 

function cardBase([ko,en,zh]){ const d=document.createElement('div'); d.className='card'; d.innerHTML=`<div class='card-inner'><div class='ko'>${ko}</div><div class='trans'><div class='en'>${en}</div><div class='zh'>${zh}</div></div><div class='act'><button class='pill' data-ko='${ko}'>韓</button><button class='pill' data-en='${en}'>英</button></div></div>`; return d; }
function cardFav(f){ const d=document.createElement('div'); d.className='card'; d.innerHTML=`<div class='card-inner'><div class='ko'>${f.ko}</div><div class='trans'><div class='en'>${f.en}</div><div class='zh'>${f.zh}</div></div><div class='act'><button class='pill' data-ko='${f.ko}'>韓</button><button class='pill' data-en='${f.en}'>英</button><span class='star on' data-fav='1' title='已收藏'><img src='icons/toboki-yellow.svg' alt='已收藏'></span></div></div>`; return d; }
function favs(){ try{ return JSON.parse(localStorage.getItem('favorites')||'[]'); }catch(e){ return []; } }
function render(cat){ const box=document.getElementById('cards'); box.innerHTML=''; (DATA[cat]||[]).forEach(x=>box.appendChild(cardBase(x)));
  // append favorites that belong to this folder name
  const folderName = document.querySelector('.tab.active')?.textContent || (cat==='R'?'餐廳':cat==='S'?'購物':cat==='N'?'問路':'其他');
  favs().filter(f=>f.folder===folderName).forEach(f=>{ box.appendChild(cardFav(f)); }); }
let PENDING_DELETE = null;

document.addEventListener('click',e=>{ 
  if(e.target.closest('#voiceEn')) return cycleVoice(); 
  if(e.target.closest('.speed')) return cycleSpeed(); 
  if(e.target.matches('[data-ko]')){ 
    e.target.classList.add('pulse','amber-temp'); 
    setTimeout(()=>e.target.classList.remove('pulse','amber-temp'),350); 
    return speakKO(e.target.getAttribute('data-ko')); 
  } 
  if(e.target.matches('[data-en]')){ 
    e.target.classList.add('pulse','amber-temp'); 
    setTimeout(()=>e.target.classList.remove('pulse','amber-temp'),350); 
    return speakEN(e.target.getAttribute('data-en')); 
  } 
  if(e.target.classList.contains('tab')){ 
    document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active')); 
    e.target.classList.add('active'); 
    render(e.target.getAttribute('data-tab')); 
    return; 
  } 
  const starElement = e.target.closest('.star');
  if(starElement){ 
    const c=starElement.closest('.card'); 
    const folder=document.querySelector('.tab.active').textContent; 
    const ko=c.querySelector('.ko').textContent; 
    const en=c.querySelector('.en').textContent; 
    const zh=c.querySelector('.zh').textContent; 
    if(starElement.hasAttribute('data-fav')){ 
      PENDING_DELETE = {ko, en, zh, folder, el: starElement};
      document.getElementById('confirmDelete').style.display='flex'; 
      return; 
    } 
  } 
  
  // 確認刪除彈窗處理
  if(e.target.id==='confirmYes' && PENDING_DELETE){ 
    const list=favs().filter(x=>!(x.ko===PENDING_DELETE.ko && x.en===PENDING_DELETE.en && x.zh===PENDING_DELETE.zh && x.folder===PENDING_DELETE.folder)); 
    localStorage.setItem('favorites', JSON.stringify(list)); 
    render(document.querySelector('.tab.active')?.getAttribute('data-tab')||'R'); 
    PENDING_DELETE = null;
    document.getElementById('confirmDelete').style.display='none'; 
    return; 
  }
  
  if(e.target.id==='confirmNo' || e.target.id==='confirmClose'){ 
    PENDING_DELETE = null;
    document.getElementById('confirmDelete').style.display='none'; 
    return; 
  }
  
  // 點擊彈窗背景關閉
  if(e.target.id==='confirmDelete') { 
    PENDING_DELETE = null;
    document.getElementById('confirmDelete').style.display='none'; 
    return; 
  }
});
ensureVoice(); updateSpeedUI();
loadMickeyState();
render("R");
</script></body></html>
